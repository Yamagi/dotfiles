# This is a rather simple configuration file for mksh, designed to
# imitate my somewhat more complex tcsh setup. This file should be
# combined with my .profile and .mksh_logout script. You may do
# whatever you want with this file, but please note that it comes
# WITHOUT ANY WARRANTY!

# -------------------------------------------------------------------- #

# 1. Settings
# -----------

# History
HISTFILE=~/.mksh_history
HISTSIZE=4096

# Enforce umask depending on host
# system and login name. 
if [[ $LOGNAME == "root" ]] ; then
	umask 022
else
	if [[ "$(uname -s)" == "FreeBSD" ]] ; then
		umask 027
	elif [[ "$(uname -s)" == "Linux" ]] ; then
		umask 077
	fi
fi

# -------------------------------------------------------------------- #

# 2. Bindings
# -----------

bind ^L=clear-screen
bind ^XA=search-history-up
bind ^XB=search-history-down
bind ^X5~=up-history
bind ^X6~=down-history

# -------------------------------------------------------------------- #

# 3. Prompt
# ---------

function _prompt()
{
	ret=$?

	typeset dir
	typeset slashes
	typeset tty

	tty=$(tty)
	tty=${tty#/dev/}

	if [[ $PWD == $HOME* ]] ; then
		dir=${PWD#$HOME}
		dir=~$dir
	else
		dir=$PWD
	fi

	slashes=${dir//[!\/]/}

	if [[ ${#slashes} -gt 2 ]] ; then
		while [[ ${#slashes} -gt 1 ]] ; do
			dir=${dir#*/}
			slashes=${dir//[!\/]/}
		done

		dir=...$dir
	fi

	REPLY="$(whoami)@$(hostname -s):$tty $dir:"

	# Return the original value of $? so that the return code
	# of the last pipeline is available to the user. Otherwise
	# the return code of this function would overwrite it.
	return $ret
}

PS1='${|_prompt} '
PS2='> '
PS3='? '
PS4='[$EPOCHREALTIME] '

# -------------------------------------------------------------------- #

# 4. Aliases

unalias -a

case "$(uname -s)" in
	FreeBSD)
		alias ls='ls -G'
		alias startx='startx -- -retro'
		alias X='X -retro'
		;;

	Linux)
		alias ls='/bin/ls --color'
		;;
esac

alias dotfiles='git --work-tree=${HOME} --git-dir=${HOME}/.dotfiles'
alias history='fc -l'
alias ll='ls -lha'
alias su='su -l'
alias suc=su
alias tmux='tmux -2'

# -------------------------------------------------------------------- #
